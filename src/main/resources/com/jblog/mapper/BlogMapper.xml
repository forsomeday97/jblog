<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jblog.mapper.BlogMapper">

	<!-- 
	<select id="getList" parameterType="String" resultType="com.jblog.vo.BlogVo">
		<![CDATA[
		
		]]>
		
	</select>
	 -->
	<select id="getCate" resultType="com.jblog.vo.CateVo"  >
		<![CDATA[
			select cateno,id,catename,description,regdate
			from category
			where id = #{id}
            order by regdate desc
		]]>
	</select>
	
	<select id="getFinalCate" resultType="com.jblog.vo.CateVo" parameterType="Map" >
		<![CDATA[
			select cateno,id,catename,description,regdate,(select count(postno)
		    from post where cateno=#{cateno})totalpost from category
		    where id=#{id} and cateno=#{cateno}
		]]>
	</select>
	
	<!-- 블로그 처음 입장 시 출력하는 포스트리스트 -->
	<select id="getFirstPost" parameterType="string"  resultType="com.jblog.vo.PostVo">
		<![CDATA[
			select postno,cateno,posttitle,postcontent,regdate
			from post
			where cateno=(SELECT max(cateno)
			FROM category where id=#{id}) 
			order by regdate desc
		]]>
	</select>
	
	
	
	<!-- 카테고리 선택 시 출력하는 포스트리스트 -->
	<select id="getPostList" resultType="com.jblog.vo.PostVo" parameterType="int">
		<![CDATA[
			select postno,cateno,posttitle,postcontent,regdate
			from post
			where cateno=#{cateno}
            order by regdate desc
		]]>
	</select>
	
	<!-- 총 포스트 갯수 -->
	<select id="getTotalPost" resultType="Integer" parameterType="int">
		<![CDATA[
			SELECT count(*) FROM post where cateno=#{cateno}
		]]>
	</select>
	
	<insert id="insertCate" parameterType="com.jblog.vo.CateVo">
	<![CDATA[
			insert into category values(seq_category_no.nextval,#{id},#{catename},#{description},sysdate)
		]]>
	</insert>
	
	<delete id="deleteCate" parameterType="int">
		<![CDATA[
			delete from category where cateno=#{cateno}
		]]>	
	</delete>
	
	<insert id="insertPost" parameterType="com.jblog.vo.PostVo">
	<![CDATA[
			insert into post values(seq_post_no.nextval,#{cateno},#{posttitle},#{postcontent},sysdate)
		]]>
	</insert>
	
	<select id="getPost" parameterType="int" resultType="com.jblog.vo.PostVo">
	<![CDATA[
			select postno,cateno,posttitle,postcontent,regdate
			from post
			where postno=#{postno}
		]]>
	</select>
	
	<update id="update" parameterType="com.jblog.vo.BlogVo">
	<![CDATA[
			update blog set blogtitle=#{blogtitle} where id=#{id}	
		]]>
	</update>
	
	<select id="getBlog" parameterType="string" resultType="com.jblog.vo.BlogVo">
	<![CDATA[
			select blogtitle,logofile,u.username
			from blog b,users u
            where b.id=u.id
            and b.id=#{id}
		]]>
	</select>	
	

</mapper>